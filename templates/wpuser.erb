#!/usr/bin/env bash

# Auto-generated by Chef.
# Local modifications will be overwritten.

#userdel -r wp-user
#useradd -m -d /home/wp-user wp-user
#rm -f /home/wp-user/wp_rsa
[ ! -f /home/wp-user/wp_rsa ] && ssh-keygen -q -t rsa -b 4096 -f /home/wp-user/wp_rsa -N ""
chown -R wp-user:wp-user <%= node['chef_wordpress']['wordpress_root'] %>
chown wp-user:www-data /home/wp-user/wp_rsa /home/wp-user/wp_rsa.pub
chmod 0600 /home/wp-user/wp_rsa /home/wp-user/wp_rsa.pub
mkdir -p /home/wp-user/.ssh
chown wp-user:wp-user /home/wp-user/.ssh/
chmod 0700 /home/wp-user/.ssh/
cp /home/wp-user/wp_rsa.pub /home/wp-user/.ssh/authorized_keys
chown wp-user:wp-user /home/wp-user/.ssh/authorized_keys
chmod 0644 /home/wp-user/.ssh/authorized_keys
perl -pi -e 's/^\s*ssh-rsa /from="127.0.0.1" ssh-rsa /' /home/wp-user/.ssh/authorized_keys
